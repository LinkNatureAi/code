<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Base64 Encode/Decode Tool</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; background: #f8f8f8; display: flex; flex-direction: column; align-items: center; }
        section { width: 100%; max-width: 700px; padding: 20px; background: #fff; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); margin-bottom: 20px; }
        label { font-weight: bold; display: block; margin-top: 10px; }
        textarea, input { width: 100%; padding: 10px; border: 1px solid #ddd; margin-bottom: 5px; }
        button { width: 100%; padding: 12px; font-size: 1rem; background: #007BFF; color: white; border: none; border-radius: 5px; cursor: pointer; margin-top: 5px; }
        button:hover { background: #0056b3; }
        .output { background: #f0f8ff; padding: 12px; border-radius: 5px; border: 1px solid #ddd; word-wrap: break-word; max-height: 200px; overflow-y: auto; }
        .copy-btn { margin-top: 5px; background: #28a745; }
        .copy-btn:hover { background: #218838; }
        .alert { color: red; margin-top: 10px; }
    </style>
</head>
<body>

<h1>Base64 Encode/Decode Tool</h1>

<section>
    <h2>Encoding</h2>
    <label for="keyEncode">Enter Encoding Key:</label>
    <input type="text" id="keyEncode">
    <label for="textdata">Text Data [<span id="charCountEncode">0</span>]:</label>
    <textarea id="textdata"></textarea>
    <button onclick="encryptAndDisplay()">Encrypt</button>
    <label>Encoded Output [<span id="charCountOutput">0</span>]:</label>
    <p id="output" class="output"></p>
    <button class="copy-btn" onclick="copyToClipboard('output')">Copy to Clipboard</button>
</section>

<section>
    <h2>Decoding</h2>
    <label for="keyDecode">Enter Decoding Key:</label>
    <input type="text" id="keyDecode">
    <label for="encodedInput">Encoded Text [<span id="charCountEncodedText">0</span>]:</label>
    <textarea id="encodedInput"></textarea>
    <button onclick="decodeAndDisplay()">Decode</button>
    <label>Decoded Output [<span id="charCountDecoded">0</span>]:</label>
    <p id="decodedOutput" class="output"></p>
    <button class="copy-btn" onclick="copyToClipboard('decodedOutput')">Copy to Clipboard</button>
    <p id="decodeError" class="alert"></p>
</section>

<script>
function xorEncryptToBase64(data, key) {
    if (!key.length) throw new Error("Key is required!");
    const encoder = new TextEncoder();
    const dataBytes = encoder.encode(data);
    const keyBytes = encoder.encode(key);
    let encryptedBytes = new Uint8Array(dataBytes.length);
    
    for (let i = 0; i < dataBytes.length; i++) {
        encryptedBytes[i] = dataBytes[i] ^ keyBytes[i % keyBytes.length];
    }

    return btoa(String.fromCharCode(...encryptedBytes));
}

function xorDecryptFromBase64(encodedData, key) {
    if (!key.length) throw new Error("Key is required!");
    const decoder = new TextDecoder();
    const keyBytes = new TextEncoder().encode(key);
    const encryptedBytes = new Uint8Array(atob(encodedData).split("").map(c => c.charCodeAt(0)));
    let decryptedBytes = new Uint8Array(encryptedBytes.length);
    
    for (let i = 0; i < encryptedBytes.length; i++) {
        decryptedBytes[i] = encryptedBytes[i] ^ keyBytes[i % keyBytes.length];
    }

    return decoder.decode(decryptedBytes);
}

function encryptAndDisplay() {
    let key = document.getElementById("keyEncode").value.trim();
    let data = document.getElementById("textdata").value;
    
    if (!key || !data) {
        alert("Please enter both a key and text.");
        return;
    }

    try {
        let encoded = xorEncryptToBase64(data, key);
        document.getElementById("output").textContent = encoded;
        document.getElementById("charCountOutput").textContent = encoded.length;
        localStorage.setItem("encodedOutput", encoded);
        localStorage.setItem("keyEncode", key);
    } catch (e) {
        document.getElementById("output").textContent = "Error: Text too long to encode!";
    }
}

function decodeAndDisplay() {
    let key = document.getElementById("keyDecode").value.trim();
    let data = document.getElementById("encodedInput").value;
    
    if (!key || !data) {
        alert("Please enter both a key and encoded text.");
        return;
    }

    try {
        let decoded = xorDecryptFromBase64(data, key);
        document.getElementById("decodedOutput").textContent = decoded;
        document.getElementById("charCountDecoded").textContent = decoded.length;
        document.getElementById("decodeError").textContent = "";
        localStorage.setItem("decodedOutput", decoded);
        localStorage.setItem("keyDecode", key);
    } catch (e) {
        document.getElementById("decodeError").textContent = "Error: Failed to decode text.";
    }
}

function copyToClipboard(elementId) {
    let text = document.getElementById(elementId).textContent;
    if (!text) {
        alert("Nothing to copy!");
        return;
    }
    
    navigator.clipboard.writeText(text).then(() => {
        alert("Copied to clipboard!");
    }).catch(err => {
        alert("Failed to copy!");
    });
}

// Update character count dynamically
document.getElementById("textdata").addEventListener("input", () => {
    let text = document.getElementById("textdata").value;
    document.getElementById("charCountEncode").textContent = text.length;
    localStorage.setItem("textData", text);
});
document.getElementById("encodedInput").addEventListener("input", () => {
    let text = document.getElementById("encodedInput").value;
    document.getElementById("charCountEncodedText").textContent = text.length;
    localStorage.setItem("encodedText", text);
});

// Load old data from localStorage
window.onload = function () {
    document.getElementById("textdata").value = localStorage.getItem("textData") || "";
    document.getElementById("encodedInput").value = localStorage.getItem("encodedText") || "";
    document.getElementById("output").textContent = localStorage.getItem("encodedOutput") || "";
    document.getElementById("decodedOutput").textContent = localStorage.getItem("decodedOutput") || "";
    document.getElementById("keyEncode").value = localStorage.getItem("keyEncode") || "";
    document.getElementById("keyDecode").value = localStorage.getItem("keyDecode") || "";

    document.getElementById("charCountEncode").textContent = document.getElementById("textdata").value.length;
    document.getElementById("charCountEncodedText").textContent = document.getElementById("encodedInput").value.length;
    document.getElementById("charCountOutput").textContent = document.getElementById("output").textContent.length;
    document.getElementById("charCountDecoded").textContent = document.getElementById("decodedOutput").textContent.length;
};
</script>

</body>
</html>
